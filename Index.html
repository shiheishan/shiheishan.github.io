<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>作业预览 · 苹果拟物</title>
  <style>
    /* ===== iOS 式拟物 / 纸感 ===== */
    :root{
      --bg-top:#ebeff5;            /* 天空淡蓝 */
      --bg-bottom:#e4e7ee;         /* 渐变底色 */
      --paper:#f9f9f7;             /* 纸张 */
      --ink:#1d1d1f;               /* 墨色 */
      --muted:#6e6e73;             /* 次级文字 */
      --accent:#34c759;            /* iOS 绿 */
      --border:#d2d2d7;
      --strike:rgba(0,0,0,.55);    /* 删除线颜色（半黑） */
      --card:#ffffffee;
      --shadow:0 12px 32px rgba(0,0,0,.10), 0 1px 0 rgba(255,255,255,.6) inset;
    }

    @media (prefers-color-scheme: dark){
      :root{
        --bg-top:#14161a; --bg-bottom:#0f1115;
        --paper:#16181d; --ink:#f2f2f7; --muted:#a1a1a6; --border:#2c2c2e;
        --card:#0f1115e6; --strike:rgba(255,255,255,.5);
      }
    }

    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body{
      margin:0; color:var(--ink); font:16px/1.6 -apple-system,BlinkMacSystemFont,"SF Pro Display","SF Pro Text",system-ui,"Helvetica Neue",Segoe UI,Arial;
      background: linear-gradient(180deg,var(--bg-top),var(--bg-bottom));
    }

    .wrap{ min-height:100%; display:grid; place-items:center; padding:32px; }

    /* 主纸面 */
    .paper{
      width:min(880px, 94vw); min-height:82vh; background:var(--paper);
      border-radius:28px; position:relative; padding:28px 28px 20px;
      box-shadow: var(--shadow);
      /* 纸张纤维感 */
      background-image:
        radial-gradient(50% 80% at 50% 0%, rgba(255,255,255,.7), rgba(255,255,255,0) 70%),
        repeating-linear-gradient(90deg, rgba(0,0,0,.02), rgba(0,0,0,.02) 1px, transparent 1px, transparent 2px),
        linear-gradient(180deg, rgba(255,255,255,.35), rgba(255,255,255,0));
      overflow:hidden;
    }
    .paper::before{ /* 内边高光 */
      content:""; position:absolute; inset:0; border-radius:28px; pointer-events:none;
      box-shadow: inset 0 1px 0 rgba(255,255,255,.7), inset 0 -1px 0 rgba(0,0,0,.06);
    }

    /* 顶部日期牌（拟物边框+高光） */
    .date-card{
      background: linear-gradient(180deg,#fff, #f2f2f6);
      border:1px solid var(--border); border-radius:16px; padding:14px 18px; 
      box-shadow: 0 8px 18px rgba(0,0,0,.10), inset 0 1px 0 rgba(255,255,255,.7);
      display:flex; align-items:center; justify-content:center; 
      font-weight:700; letter-spacing:.5px; font-size:20px; color:var(--ink);
    }

    /* 内容区 */
    .content{ margin-top:18px; display:grid; grid-template-columns: 1fr 310px; gap:18px; }
    @media (max-width: 900px){ .content{ grid-template-columns: 1fr; } }

    /* 学科卡片 */
    .subject{
      background: var(--card); border:1px solid var(--border); border-radius:18px;
      box-shadow: 0 6px 16px rgba(0,0,0,.08), inset 0 1px 0 rgba(255,255,255,.4);
      padding:14px 16px; margin-bottom:14px;
    }
    .subject-title{ font-weight:700; font-size:18px; margin:2px 0 8px; letter-spacing:.2px; }
    .tasks{ margin:0; padding:0; list-style:none; }

    /* ===== 任务行（自定义勾选 + 渐进删除线 + 文字半透明） ===== */
    @property --p{ syntax: '<number>'; initial-value: 0; inherits: false; }

    .task{ display:flex; align-items:center; gap:12px; padding:10px 6px; border-radius:12px; position:relative; }
    .task:hover{ background:linear-gradient(180deg, rgba(0,0,0,.04), transparent); }

    /* 隐藏原生复选框 */
    .task input{ position:absolute; opacity:0; pointer-events:none; }

    /* 自定义方框（iOS风） */
    .checkbox{ width:22px; height:22px; border-radius:8px; border:1px solid var(--border); background:linear-gradient(180deg,#fff,#f3f4f6);
      box-shadow:inset 0 1px 0 rgba(255,255,255,.8);
      display:inline-grid; place-items:center; flex:0 0 22px; position:relative; overflow:hidden;
    }
    .checkbox::after{ /* 绿色对勾 */
      content:""; width:10px; height:6px; border:3px solid var(--accent); border-right:none; border-top:none;
      transform: rotate(-45deg) scale(0); transform-origin: 100% 100%; transition:transform .28s cubic-bezier(.2,.9,.3,1.5);
    }

    /* 文字容器：用背景渐变驱动“由左到右变半透明”的效果 */
    .text{ position:relative; font-size:16px; letter-spacing:.2px; line-height:1.4; 
      color:transparent; -webkit-background-clip:text; background-clip:text; 
      /* 左侧为半黑，右侧为纯黑，过渡边沿 2% 提升丝滑感 */
      background-image: linear-gradient(90deg,
          rgba(0,0,0,.55) 0%,
          rgba(0,0,0,.55) calc((var(--p)*100% - 2%)),
          rgba(0,0,0,1) calc(var(--p)*100%),
          rgba(0,0,0,1) 100%
      );
      transition: --p .42s ease; /* 自定义属性动画 */
    }
    /* 删除线（宽度与 --p 同步） */
    .text::after{ content:""; position:absolute; left:0; right:0; top:50%; height:2px; border-radius:2px; background:var(--strike);
      transform: translateY(-50%) scaleX(var(--p)); transform-origin: left center; transition: transform .42s ease; }

    /* 状态联动：勾选时把 --p 置 1，同时让对勾弹出 */
    .task input:checked ~ .checkbox::after{ transform: rotate(-45deg) scale(1); }
    .task input:checked ~ .text{ --p: 1; }
    .task input:not(:checked) ~ .text{ --p: 0; }

    /* 侧栏：进度甜甜圈卡 */
    .aside{ position:relative; background:var(--card); border:1px solid var(--border); border-radius:18px; padding:18px; box-shadow: 0 6px 16px rgba(0,0,0,.08), inset 0 1px 0 rgba(255,255,255,.4); }
    .aside h3{ margin:2px 0 12px; font-size:16px; font-weight:700; color:var(--muted); }

    .donut{ width:100%; display:grid; place-items:center; }
    .donut svg{ width:min(260px, 70vw); height:auto; }
    .donut .pct{ font-weight:800; font-size:26px; text-anchor:middle; dominant-baseline: central; }

    /* 全部完成后的结语屏 */
    .done-screen{ position:absolute; inset:0; display:none; align-items:center; justify-content:center; text-align:center; padding:24px; }
    .done-screen .card{ background:var(--card); border:1px solid var(--border); border-radius:22px; padding:28px 22px; box-shadow:0 12px 26px rgba(0,0,0,.12), inset 0 1px 0 rgba(255,255,255,.5); }
    .done-screen h1{ margin:0 0 6px; font-size:22px; }
    .done-screen p{ margin:0; color:var(--muted); }

    /* 离子消除：纸面瓦解 → 粒子溶解 */
    .disintegrate .paper{ animation: paper-out .9s ease forwards; }
    @keyframes paper-out{ 0%{filter:none; opacity:1; transform:translateY(0) scale(1);} 60%{filter:blur(2px); opacity:.6;} 100%{filter:blur(8px); opacity:0; transform:translateY(10px) scale(.98);} }

    /* 粒子画布 */
    #ion-canvas{ position:absolute; inset:0; display:none; }
    .disintegrate #ion-canvas{ display:block; }
    .show-done .done-screen{ display:flex; }

    /* 小提示 */
    .hint{ margin:10px 0 0; font-size:12px; color:var(--muted); }
  </style>
</head>
<body>
  <div class="wrap" id="app">
    <canvas id="ion-canvas"></canvas>

    <main class="paper" id="paper">
      <div class="date-card" aria-live="polite">
        <span id="now">——</span>
      </div>

      <div class="content">
        <section>
          <div id="subjects"></div>
        </section>
        <aside class="aside">
          <h3>今日进度</h3>
          <div class="donut">
            <svg viewBox="0 0 160 160" aria-hidden="true">
              <defs>
                <filter id="innershadow" x="-50%" y="-50%" width="200%" height="200%">
                  <feOffset dx="0" dy="2"/>
                  <feGaussianBlur stdDeviation="2" result="offset-blur"/>
                  <feComposite operator="out" in="SourceGraphic" in2="offset-blur" result="inverse"/>
                  <feFlood flood-color="#000" flood-opacity="0.25" result="color"/>
                  <feComposite operator="in" in="color" in2="inverse" result="shadow"/>
                  <feComposite operator="over" in="shadow" in2="SourceGraphic"/>
                </filter>
              </defs>
              <circle cx="80" cy="80" r="60" fill="#fff" filter="url(#innershadow)" />
              <circle cx="80" cy="80" r="60" fill="none" stroke="#e6e6ea" stroke-width="16"/>
              <circle id="ring" cx="80" cy="80" r="60" fill="none" stroke="var(--accent)" stroke-width="16" stroke-linecap="round" stroke-dasharray="377" stroke-dashoffset="377" transform="rotate(-90 80 80)"/>
              <text x="80" y="80" class="pct" id="pctText">0%</text>
            </svg>
          </div>
          <div class="hint">勾选作业可更新进度；全部完成后页面会“离子消除”。</div>
        </aside>
      </div>

      <div class="done-screen" id="done">
        <div class="card">
          <h1>今日任务已完成</h1>
          <p>请好好休息。</p>
        </div>
      </div>
    </main>
  </div>

  <script>
    // ====== 数据：可按需调整 ======
    const DATA = [
      { name: '语文', tasks: ['背诵《木兰诗》前半段', '完成练习册 P12-15 选择题'] },
      { name: '数学', tasks: ['函数单调性 2-12 题', '错题本整理 10 分钟'] },
      { name: '英语', tasks: ['背词 Unit 3 A-B', '完成 Workbook P20-23'] },
      { name: '物理', tasks: ['受力分析 3 道题', '预习 杠杆与力矩'] },
      { name: '化学', tasks: ['元素周期表默写', '完成配平 5 题'] },
      { name: '生物', tasks: ['细胞结构速记 15 分钟'] },
      { name: '历史', tasks: ['明清时期复习提纲'] },
      { name: '政治', tasks: ['核心价值观要点背诵'] },
      { name: '地理', tasks: ['世界气候类型速查表'] }
    ];

    // ====== DOM 渲染 ======
    const subjectsEl = document.getElementById('subjects');
    const ring = document.getElementById('ring');
    const pctText = document.getElementById('pctText');
    const app = document.getElementById('app');
    const paper = document.getElementById('paper');
    const doneScreen = document.getElementById('done');
    const ionCanvas = document.getElementById('ion-canvas');

    const CIRCUM = 2 * Math.PI * 60; // r = 60

    function render(){
      const frag = document.createDocumentFragment();
      DATA.forEach((subj, si) => {
        const card = document.createElement('div');
        card.className = 'subject';
        card.dataset.index = si;
        card.innerHTML = `<div class="subject-title">${subj.name}</div>`;
        const ul = document.createElement('ul');
        ul.className = 'tasks';
        subj.tasks.forEach((t, ti) => {
          const li = document.createElement('li');
          const id = `s${si}t${ti}`;
          li.innerHTML = `
            <label class="task" for="${id}">
              <input id="${id}" type="checkbox" />
              <span class="checkbox" aria-hidden="true"></span>
              <span class="text">${t}</span>
            </label>`;
          ul.appendChild(li);
        });
        card.appendChild(ul);
        frag.appendChild(card);
      });
      subjectsEl.appendChild(frag);

      subjectsEl.addEventListener('change', onToggle, { passive: true });
      updateProgress();
    }

    function allInputs(){ return [...subjectsEl.querySelectorAll('input[type="checkbox"]')]; }

    function onToggle(e){
      const target = e.target;
      if(target && target.matches('input[type="checkbox"]')){
        updateProgress();
      }
    }

    function updateProgress(){
      const inputs = allInputs();
      const total = inputs.length;
      const done = inputs.filter(i=>i.checked).length;
      const pct = total ? Math.round(done/total*100) : 100;

      ring.style.strokeDasharray = CIRCUM;
      ring.style.strokeDashoffset = (1 - pct/100) * CIRCUM;
      pctText.textContent = pct + '%';

      if(done === total && total > 0){
        celebrateAndVanish();
      }
    }

    // ====== 实时日期时钟 ======
    function pad(n){ return n.toString().padStart(2,'0'); }
    function tick(){
      const d = new Date();
      const str = `${d.getFullYear()}年${d.getMonth()+1}月${d.getDate()}日 ${pad(d.getHours())}:${pad(d.getMinutes())}:${pad(d.getSeconds())}`;
      document.getElementById('now').textContent = str;
      requestAnimationFrame(()=>setTimeout(tick, 250));
    }

    // ====== 离子消除动画（简版粒子溶解） ======
    function celebrateAndVanish(){
      // 防抖：只触发一次
      if(app.classList.contains('disintegrate')) return;
      app.classList.add('disintegrate');

      const rect = paper.getBoundingClientRect();
      const cw = ionCanvas.width = rect.width * devicePixelRatio;
      const ch = ionCanvas.height = rect.height * devicePixelRatio;
      ionCanvas.style.left = rect.left + 'px';
      ionCanvas.style.top = rect.top + 'px';
      const ctx = ionCanvas.getContext('2d');

      const particles = []; const N = 320; // 颗粒数
      for(let i=0;i<N;i++){
        particles.push({
          x: (Math.random()*cw),
          y: (Math.random()*ch),
          vx: (Math.random()-0.5)*2.2,
          vy: -Math.random()*2 - .5,
          r: Math.random()*2 + .6,
          life: 1,
        });
      }

      ionCanvas.style.display = 'block';
      let t0 = null;
      function step(ts){
        if(!t0) t0 = ts; const dt = Math.min(1, (ts - t0)/1000);
        ctx.clearRect(0,0,cw,ch);
        particles.forEach(p=>{
          p.x += p.vx*3; p.y += p.vy*3; p.vy += 0.03; p.life -= 0.008;
          ctx.globalAlpha = Math.max(0, p.life);
          ctx.fillStyle = '#9ad6a8';
          ctx.beginPath(); ctx.arc(p.x,p.y,p.r,0,Math.PI*2); ctx.fill();
        });
        if(particles.some(p=>p.life>0)){
          requestAnimationFrame(step);
        }else{
          // 展示完成提示
          app.classList.remove('disintegrate');
          paper.style.display = 'none';
          app.classList.add('show-done');
        }
      }
      requestAnimationFrame(step);
    }

    // 启动
    render();
    tick();
  </script>
</body>
</html>
